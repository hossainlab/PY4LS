<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Alison Presmanes Hill" />


<title>CONJ620: CM 3.4</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/flatly.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */


</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 60px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 65px;
  margin-top: -65px;
}

.section h2 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h3 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h4 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h5 {
  padding-top: 65px;
  margin-top: -65px;
}
.section h6 {
  padding-top: 65px;
  margin-top: -65px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">CONJ 620</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="cm.html">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Class Meetings
  </a>
</li>
<li>
  <a href="due.html">
    <span class="fa fa-calendar-check"></span>
     
    Due Dates
  </a>
</li>
<li>
  <a href="https://distracted-bhabha-a42d09.netlify.com">
    <span class="fa fa-key"></span>
     
    Grades
  </a>
</li>
<li>
  <a href="https://www.datacamp.com/enterprise/conj-620-introduction-to-biostatistics-for-the-basic-sciences-data-wrangling-analysis-communication">
    <span class="fa fa-user-ninja"></span>
     
    DataCamp
  </a>
</li>
<li>
  <a href="https://sakai.ohsu.edu/portal/site/CONJ-620-1-2040-Su18">
    <span class="fa fa-university"></span>
     
    Sakai
  </a>
</li>
<li>
  <a href="https://gitter.im/conj620/Lobby?utm_source=share-link&amp;utm_medium=link&amp;utm_campaign=share-link">
    <span class="fa fa-comments"></span>
     
    Gitter Chat
  </a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="about.html">
    <span class="fa fa-cogs"></span>
     
    About
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">CONJ620: CM 3.4</h1>
<h3 class="subtitle"><em>Permutation tests</em></h3>
<h4 class="author"><em>Alison Presmanes Hill</em></h4>

</div>


<div id="logistics" class="section level1">
<h1>Logistics</h1>
<ul>
<li>A complete knitted <code>html</code> file is due on Sakai by Tuesday August 21rd (2:30pm).</li>
<li>This lab is based on the assigned reading that includes <a href="http://moderndive.netlify.com/10-hypothesis-testing.html#example-comparing-two-means">ModernDive Chapter 10.7</a>. Please open and follow closely!</li>
<li>Note that in class, several people were getting a mysterious <code>glue</code> error in their console. The solution that seemed to work was to explicitly install the <code>glue</code> package using: <code>install.packages(&quot;glue&quot;)</code>, then restarting RStudio.</li>
</ul>
</div>
<div id="packages" class="section level1">
<h1>Packages</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tidyverse)
<span class="kw">library</span>(infer)
<span class="kw">library</span>(skimr)</code></pre></div>
</div>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>You have my permission to watch this video, stop it at 4 minutes 5 seconds: <a href="https://www.youtube.com/watch?v=PdLPe7XjdKc" class="uri">https://www.youtube.com/watch?v=PdLPe7XjdKc</a></p>
<p>Let's play with some obviously fictitious data. Our outcome measure is the Sneetch Snootiness Index (SSI), which we measured for both plain-bellied sneetches (<code>plain</code>) and those with stars upon thars (<code>stars</code>). Here is our data for N = 20 sneetches, where I have SSI scores for m = 8 star-bellied sneetches and n = 12 plain-bellied sneetches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">stars &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">84</span>, <span class="dv">57</span>, <span class="dv">63</span>, <span class="dv">99</span>, <span class="dv">72</span>, <span class="dv">46</span>, <span class="dv">76</span>, <span class="dv">91</span>, <span class="kw">rep</span>(<span class="ot">NA</span>, <span class="dv">4</span>))
plain &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">81</span>, <span class="dv">74</span>, <span class="dv">56</span>, <span class="dv">69</span>, <span class="dv">66</span>, <span class="dv">62</span>, <span class="dv">69</span>, <span class="dv">61</span>, <span class="dv">87</span>, <span class="dv">65</span>, <span class="dv">44</span>, <span class="dv">69</span>)
sneetches &lt;-<span class="st"> </span><span class="kw">data.frame</span>(stars, plain)
sneetches_tidy &lt;-<span class="st"> </span>sneetches <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">gather</span>(group, SSI, <span class="dt">factor_key =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">filter</span>(<span class="op">!</span><span class="kw">is.na</span>(SSI))
sneetches_tidy</code></pre></div>
<pre><code>   group SSI
1  stars  84
2  stars  57
3  stars  63
4  stars  99
5  stars  72
6  stars  46
7  stars  76
8  stars  91
9  plain  81
10 plain  74
11 plain  56
12 plain  69
13 plain  66
14 plain  62
15 plain  69
16 plain  61
17 plain  87
18 plain  65
19 plain  44
20 plain  69</code></pre>
<p><img src="https://celebratingdrseuss.files.wordpress.com/2014/02/sneetches_on_beaches.jpg"/></p>
<p>Let's look at our data for N = 20 sneetches, where I have SSI scores for m = 8 star-bellied sneetches and n = 12 plain-bellied sneetches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sneetch_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(sneetches_tidy, <span class="kw">aes</span>(<span class="dt">x =</span> group, 
                                           <span class="dt">y =</span> SSI)) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_boxplot</span>(<span class="dt">outlier.shape =</span> <span class="ot">NA</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">geom_jitter</span>(<span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">height =</span> <span class="dv">0</span>, <span class="dt">width =</span> <span class="fl">0.2</span>), 
              <span class="dt">fill =</span> <span class="st">&quot;lightseagreen&quot;</span>, 
              <span class="dt">colour =</span> <span class="st">&quot;lightseagreen&quot;</span>, 
              <span class="dt">alpha =</span> <span class="fl">0.75</span>, 
              <span class="dt">size =</span> <span class="dv">4</span>, 
              <span class="dt">na.rm=</span><span class="ot">TRUE</span>)
<span class="kw">suppressWarnings</span>(<span class="kw">print</span>(sneetch_plot))</code></pre></div>
<p><img src="cm034_files/figure-html/unnamed-chunk-4-1.png" /><!-- --></p>
</div>
<div id="model-of-h_0" class="section level1">
<h1>Model of <span class="math inline">\(H_0\)</span></h1>
<p>We'll use this data to compare two means using a randomization or permutation test. Our null/alternative hypotheses are:</p>
<p><span class="math inline">\(H_0: \mu_{stars} \leq \mu_{plain}\)</span>, which can also be written as <span class="math inline">\(H_0: \mu_{stars} - \mu_{plain} \leq 0\)</span>.</p>
<p>Our alternative hypothesis will be of the form <span class="math inline">\(H_a: \mu_1 \star \mu_2\)</span> (or <span class="math inline">\(H_a: \mu_1 - \mu_2 \, \star \, 0\)</span>) where <span class="math inline">\(\star\)</span> = <span class="math inline">\(&lt;\)</span>, <span class="math inline">\(\ne\)</span>, or <span class="math inline">\(&gt;\)</span>. For this example, we'll use: <span class="math inline">\(H_a: \mu_{stars} &gt; \mu_{plain}\)</span>.</p>
<p>So to sum up:</p>
<ul>
<li><span class="math inline">\(H_0: \mu_{stars} - \mu_{plain} \leq 0\)</span></li>
<li><span class="math inline">\(H_a: \mu_{stars} - \mu_{plain} &gt; 0\)</span></li>
</ul>
<p>Do we have reason to believe, based on the sample distributions of SSIs over the two groups of sneetches, that there is a significant difference between the mean SSI values for star-bellied compared to plain-bellied sneetches? It’s hard to say just based on the plots.</p>
</div>
<div id="test-statistic-delta" class="section level1">
<h1>Test statistic <span class="math inline">\(\delta\)</span></h1>
<p>We are, therefore, interested in seeing whether the difference in the sample means, <span class="math inline">\(\bar{x}_{stars} - \bar{x}_{plain}\)</span>, is statistically greater than 0. We can now come back to our <code>infer</code> pipeline for computing our observed statistic. Note the <code>order</code> argument that shows the mean value for <code>&quot;plain&quot;</code> being subtracted from the mean value of <code>&quot;stars&quot;</code>.</p>
</div>
<div id="observed-effect-delta" class="section level1">
<h1>Observed effect <span class="math inline">\(\delta^*\)</span></h1>
<p>Our first step is to calculate the difference between sample means you got!</p>
<p>Note: in class I used a way harder way- this way is much easier :)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_diff &lt;-<span class="st"> </span>sneetches_tidy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">specify</span>(SSI <span class="op">~</span><span class="st"> </span>group) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">calculate</span>(<span class="dt">stat =</span> <span class="st">&quot;diff in means&quot;</span>, 
            <span class="dt">order =</span> <span class="kw">c</span>(<span class="st">&quot;stars&quot;</span>, <span class="st">&quot;plain&quot;</span>)) 
mean_diff</code></pre></div>
<pre><code># A tibble: 1 x 1
   stat
  &lt;dbl&gt;
1  6.58</code></pre>
<p>Our goal next is to figure out a random process with which to simulate the null hypothesis being true. Recall that <span class="math inline">\(H_0: \mu_{stars} - \mu_{plain} \leq 0\)</span> corresponds to us assuming that the population means are the same (or that stars are less than plain). We would like to assume the null is true and perform a random process to <code>generate()</code> data in the model of the null hypothesis.</p>
</div>
<div id="reshuffling" class="section level1">
<h1>Reshuffling</h1>
<p>The basic idea to a permutation test is that we reshuffle the deck. Here the deck is our observed sample data, and when we reshuffle, we are re-ordering the samples according to the null hypothesis as if the group that each observation came from (<code>stars</code> versus <code>plain</code>) does not matter. First, imagine that all of our observed SSI scores are stored in one vector (both groups stacked on top of each other), and numbered 1 through 20 (regardless of group).</p>
<p>Next, we shuffle the non-missing observation numbers (rows 1:20), choosing a new <code>stars</code> group of size n = 8 from the n = 20 observed data points <strong>without replacement</strong>. Let's do this once:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2018</span>)
sn1 &lt;-<span class="st"> </span>sneetches_tidy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">specify</span>(SSI <span class="op">~</span><span class="st"> </span>group) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">hypothesize</span>(<span class="dt">null =</span> <span class="st">&quot;independence&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">generate</span>(<span class="dt">reps =</span> <span class="dv">1</span>, <span class="dt">type =</span> <span class="st">&quot;permute&quot;</span>)
sn1</code></pre></div>
<pre><code>Response: SSI (numeric)
Explanatory: group (factor)
Null Hypothesis:  independence 
# A tibble: 20 x 3
# Groups:   replicate [1]
     SSI group replicate
   &lt;dbl&gt; &lt;fct&gt;     &lt;int&gt;
 1    76 stars         1
 2    81 stars         1
 3    57 stars         1
 4    99 stars         1
 5    91 stars         1
 6    72 stars         1
 7    44 stars         1
 8    65 stars         1
 9    69 plain         1
10    69 plain         1
11    87 plain         1
12    46 plain         1
13    61 plain         1
14    69 plain         1
15    56 plain         1
16    74 plain         1
17    66 plain         1
18    62 plain         1
19    63 plain         1
20    84 plain         1</code></pre>
<p>Take a few minutes to confirm for yourself, using <code>skimr</code> for example, that:</p>
<ul>
<li>The overall <span class="math inline">\(N\)</span> is the same in this resample as in our original sample (20)</li>
<li>The per-group <span class="math inline">\(n\)</span>'s are the same in this resample as in our original sample</li>
<li>The overall mean of <code>SSI</code> is the same as in your original sample data</li>
<li>The group means of <code>SSI</code> in this resample <em>are</em> different from in your original sample data (this is what will change for each replicate!)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># original mean</span>
<span class="kw">skim</span>(sneetches_tidy)</code></pre></div>
<pre><code>Skim summary statistics
 n obs: 20 
 n variables: 2 

Variable type: factor 
 variable missing complete  n n_unique             top_counts ordered
    group       0       20 20        2 pla: 12, sta: 8, NA: 0   FALSE

Variable type: numeric 
 variable missing complete  n  mean    sd p0   p25 p50   p75 p100     hist
      SSI       0       20 20 69.55 14.13 44 61.75  69 77.25   99 ▃▃▅▇▅▃▃▂</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># original means by group</span>
sneetches_tidy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(group) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">skim</span>()</code></pre></div>
<pre><code>Skim summary statistics
 n obs: 20 
 n variables: 2 
 group variables: group 

Variable type: numeric 
 group variable missing complete  n  mean    sd p0   p25  p50   p75 p100
 stars      SSI       0        8  8 73.5  17.78 46 61.5  74   85.75   99
 plain      SSI       0       12 12 66.92 11.17 44 61.75 67.5 70.25   87
     hist
 ▇▇▇▇▇▇▇▇
 ▂▁▂▆▇▂▂▂</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># resample mean</span>
<span class="kw">skim</span>(sn1)</code></pre></div>
<pre><code>Skim summary statistics
 n obs: 20 
 n variables: 3 
 group variables: replicate 

Variable type: factor 
 replicate variable missing complete  n n_unique             top_counts
         1    group       0       20 20        2 pla: 12, sta: 8, NA: 0
 ordered
   FALSE

Variable type: numeric 
 replicate variable missing complete  n  mean    sd p0   p25 p50   p75
         1      SSI       0       20 20 69.55 14.13 44 61.75  69 77.25
 p100     hist
   99 ▃▃▅▇▅▃▃▂</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># resampled means by group</span>
sn1 <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(group) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">skim</span>()</code></pre></div>
<pre><code>Skim summary statistics
 n obs: 20 
 n variables: 3 
 group variables: group 

Variable type: integer 
 group  variable missing complete  n mean sd p0 p25 p50 p75 p100     hist
 stars replicate       0        8  8    1  0  1   1   1   1    1 ▁▁▁▇▁▁▁▁
 plain replicate       0       12 12    1  0  1   1   1   1    1 ▁▁▁▇▁▁▁▁

Variable type: numeric 
 group variable missing complete  n  mean    sd p0   p25  p50   p75 p100
 stars      SSI       0        8  8 73.12 17.87 44 63    74   83.5    99
 plain      SSI       0       12 12 67.17 11.24 46 61.75 67.5 70.25   87
     hist
 ▃▃▁▃▇▃▃▃
 ▂▂▂▇▇▂▁▅</code></pre>
<p>Remember, our observed mean is 6.58. So, this new resampled mean difference is 5.96, calculated as if it didn't matter if the real <code>stars</code> were <code>stars</code>, is much smaller. Now, this was just one possible resample. How many possible ways are there to choose 8 observations from 20?</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">choose</span>(<span class="dv">20</span>, <span class="dv">8</span>)</code></pre></div>
<pre><code>[1] 125970</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># choose(20, 12) same thing</span></code></pre></div>
<p>That is, there are 125970 possible permutations: <span class="math display">\[\binom{m + n}{m} = \binom{8 + 12}{8} = 125970\]</span></p>
<p>This number is not so crazy because we have pretty small sample sizes, but with real data, you'll often find the number of possible permutations is pretty unmanageable. So we make do with an approximation: we will take a large number of resamples, resampling <strong>with replacement from the null distribution</strong> of <span class="math inline">\(\binom{m + n}{m}\)</span> possible resamples. Sampling without replacement would be more accurate, but it would require too much time and memory to check the uniqueness of each resample. Long story short: we don't create <strong>all possible resamples</strong> in a permutation test, which is why this is referred to as a <a href="https://en.wikipedia.org/wiki/Resampling_%28statistics%29#Monte_Carlo_testing">Monte Carlo permutation test</a>.</p>
</div>
<div id="distribution-of-delta-under-h_0" class="section level1">
<h1>Distribution of <span class="math inline">\(\delta\)</span> under <span class="math inline">\(H_0\)</span></h1>
<p>We can now proceed in a similar way to what we have done previously with bootstrapping by repeating this process many times to create simulated samples, assuming the null hypothesis is true.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">1980</span>)
null_distn &lt;-<span class="st"> </span>sneetches_tidy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">specify</span>(SSI <span class="op">~</span><span class="st"> </span>group) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">hypothesize</span>(<span class="dt">null =</span> <span class="st">&quot;independence&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">generate</span>(<span class="dt">reps =</span> <span class="dv">1000</span>, <span class="dt">type =</span> <span class="st">&quot;permute&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">calculate</span>(<span class="dt">stat =</span> <span class="st">&quot;diff in means&quot;</span>, 
            <span class="dt">order =</span> <span class="kw">c</span>(<span class="st">&quot;stars&quot;</span>, <span class="st">&quot;plain&quot;</span>))</code></pre></div>
<p>A <strong>null distribution</strong> of simulated differences in sample means is created with the specification of <code>stat = &quot;diff in means&quot;</code> for the <code>calculate()</code> step. The <strong>null distribution</strong> is similar to the bootstrap distribution we saw in <a href="http://moderndive.netlify.com/9-confidence-intervals.html">Chapter 9</a>, but remember that it consists of statistics generated assuming the null hypothesis is true. Let's plot the permutation distribution, which is the distribution of mean differences across all permutation resamples:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">null_distn <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">visualize</span>()</code></pre></div>
<p><img src="cm034_files/figure-html/unnamed-chunk-11-1.png" /><!-- --></p>
<p>So here, what you are looking at, is our <em>new</em> null distribution- one that is <em>not</em> based on any distributional assumptions. Rather, this null distribution (the permutation distribution) is based on our sample data, and we ask &quot;in how many permutation resamples did we get a [insert statistic here] as or more extreme than the one we got with our actual sample data?&quot;</p>
<p>So, how many resampled mean differences are as or more extreme than the one we got? The answer to this question is why we calculate the p-value.</p>
</div>
<div id="the-p-value" class="section level1">
<h1>The p-value</h1>
<p>Remember that we are interested in seeing where our observed sample mean difference of 6.5833333 falls on this null/randomization distribution. We are interested stars being greater than plain, so &quot;more extreme&quot; corresponds to values in the right tail on the distribution. Let's shade our null distribution to show a visual representation of our <span class="math inline">\(p\)</span>-value:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">null_distn <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">visualize</span>(<span class="dt">obs_stat =</span> mean_diff, <span class="dt">direction =</span> <span class="st">&quot;greater&quot;</span>)</code></pre></div>
<p><img src="cm034_files/figure-html/unnamed-chunk-12-1.png" /><!-- --></p>
<p>Remember that the observed difference in means was 6.5833333. We have shaded red all values at or above that value. By giving <code>obs_stat = mean_diff</code>, a vertical darker line is also shown at 6.5833333.</p>
<p>At this point, it is important to take a guess as to what the <span class="math inline">\(p\)</span>-value may be. We can see that there are only a few permuted differences as or more large than our observed effect. Lastly, we calculate the <span class="math inline">\(p\)</span>-value directly using <code>infer</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">mean_diff_number &lt;-<span class="st"> </span>mean_diff <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">pull</span>(<span class="dv">1</span>)

(pvalue &lt;-<span class="st"> </span>null_distn <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">get_pvalue</span>(<span class="dt">obs_stat =</span> mean_diff, <span class="dt">direction =</span> <span class="st">&quot;greater&quot;</span>))</code></pre></div>
<pre><code># A tibble: 1 x 1
  p_value
    &lt;dbl&gt;
1   0.159</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># same as...</span>
null_distn <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(<span class="dt">val =</span> stat <span class="op">&gt;=</span><span class="st"> </span>mean_diff_number) </code></pre></div>
<pre><code># A tibble: 2 x 2
  val       n
  &lt;lgl&gt; &lt;int&gt;
1 FALSE   841
2 TRUE    159</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="dv">159</span><span class="op">/</span><span class="dv">1000</span></code></pre></div>
<pre><code>[1] 0.159</code></pre>
<p>We have around 15.9% of values as or more large than our observed statistic. Assuming we are using a 5% significance level for <span class="math inline">\(\alpha\)</span>, we lack evidence supporting the conclusion that the mean SSI scores are higher in star-bellied compared to plain-bellied sneetches.</p>
</div>
<div id="corresponding-confidence-interval" class="section level1">
<h1>Corresponding confidence interval</h1>
<p>One of the great things about the <code>infer</code> pipeline is that going between hypothesis tests and confidence intervals is incredibly simple. To create a null distribution, we ran:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">null_distn &lt;-<span class="st"> </span>sneetches_tidy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">specify</span>(SSI <span class="op">~</span><span class="st"> </span>group) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">hypothesize</span>(<span class="dt">null =</span> <span class="st">&quot;independence&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">generate</span>(<span class="dt">reps =</span> <span class="dv">1000</span>, <span class="dt">type =</span> <span class="st">&quot;permute&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">calculate</span>(<span class="dt">stat =</span> <span class="st">&quot;diff in means&quot;</span>, 
            <span class="dt">order =</span> <span class="kw">c</span>(<span class="st">&quot;stars&quot;</span>, <span class="st">&quot;plain&quot;</span>))</code></pre></div>
<p>To get the corresponding bootstrap distribution with which we can compute a confidence interval, we can just remove or comment out the <code>hypothesize()</code> step since we are no longer assuming the null hypothesis is true when we bootstrap:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">boot_sneetch_ci &lt;-<span class="st"> </span>sneetches_tidy <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">specify</span>(SSI <span class="op">~</span><span class="st"> </span>group) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="co">#hypothesize(null = &quot;independence&quot;) %&gt;% </span>
<span class="st">  </span><span class="kw">generate</span>(<span class="dt">reps =</span> <span class="dv">1000</span>, <span class="dt">type =</span> <span class="st">&quot;bootstrap&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">calculate</span>(<span class="dt">stat =</span> <span class="st">&quot;diff in means&quot;</span>, 
            <span class="dt">order =</span> <span class="kw">c</span>(<span class="st">&quot;stars&quot;</span>, <span class="st">&quot;plain&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">get_ci</span>()

boot_sneetch_ci</code></pre></div>
<pre><code># A tibble: 1 x 2
  `2.5%` `97.5%`
   &lt;dbl&gt;   &lt;dbl&gt;
1  -7.54    20.0</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#see ci</span>
null_distn <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">visualize</span>(<span class="dt">endpoints =</span> boot_sneetch_ci, 
            <span class="dt">direction =</span> <span class="st">&quot;between&quot;</span>)</code></pre></div>
<p><img src="cm034_files/figure-html/unnamed-chunk-15-1.png" /><!-- --></p>
<p>The question to ask yourself when looking at this plot is: is 0 in my 95% confidence interval? If it is, then a difference of 0 is plausible, and I cannot reject the null hypothesis.</p>
</div>
<div id="assumptions-caveats" class="section level1">
<h1>Assumptions &amp; Caveats</h1>
<p>Permutation tests cannot solve all problems: they are valid only when the null hypothesis is 'no association'. Pooling the data to do a two-sample permutation test <em>does</em> require that the two <em>populations</em> (not necessarily samples) have the same distribution when the null hypothesis is true, that is, the mean, spread, and shape are the same. But you should feel fairly confident that, for example, there is not bias present in one sample. Like all methods, it will only work if your samples are representative - always be careful about selection biases! You may also get into dangerous territory if you have sample sizes in your two groups that are pretty uneven (also known as unbalanced), and this is accompanied by group differences in spread. When groups are the same size, the Type I error rate is typically close to the nominal level, otherwise it can be too high or too low.</p>
<p><img src="https://booksmykidsread.files.wordpress.com/2014/03/sneetches.png"/></p>
</div>

<p>
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">
<img alt="Creative Commons License" style="border-width:0" src="by-nc.png" height="400" width="65"/></a>
</p>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
